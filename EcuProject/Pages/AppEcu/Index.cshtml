@page
@model EcuProject.Pages.AppEcu.IndexModel

@{
    ViewData["Title"] = "ECU Data";
}

<h3>ECU Data</h3>
<form id="filterForm" method="get" class="form-inline">
    <div class="row">
        <div class="col-md-6">
            <div class="row">
                <div class="col-4">
                    <label class="mr-2">Full text search:</label>
                </div>
                <div class="col-4">
                    <input type="text" class="form-control" id="fullTextSearch" name="FullTextSearch" placeholder="Search ..." oninput="performSearch()">
                </div>
            </div><br />
            <div class="row">
                <div class="col-4">
                    <label for="ecuTypeFilter" class="mr-2">Filter by ecu type:</label>
                </div>
                <div class="col-4">
                    <select class="form-control" id="ecuTypeFilter" name="SelectedEcuTypeId" asp-for="SelectedEcuTypeId">
                        <option value="0">Select ecu type</option>
                        @foreach (var ecuType in Model.AppEcuTypes)
                        {
                            <option value="@ecuType.Id">@ecuType.Name</option>
                        }
                    </select>
                </div>
            </div><br />
            <div class="row">
                <div class="col-4">
                    <label for="carmakerFilter" class="mr-2">Filter by car maker:</label>
                </div>
                <div class="col-4">
                    <select class="form-control" id="carmakerFilter" name="SelectedCarmakerId" asp-for="SelectedCarmakerId">
                        <option value="0">Select car maker</option>
                        @foreach (var carmaker in Model.AppCarmakers)
                        {
                            <option value="@carmaker.Id">@carmaker.Name</option>
                        }
                    </select>
                </div>
            </div><br />
            <div class="row">
                <div class="col-4">
                    <label for="producerFilter" class="mr-2">Filter by ecu producer:</label>
                </div>
                <div class="col-4">
                    <select class="form-control" id="carmakerFilter" name="SelectedEcuProducerId" asp-for="SelectedEcuProducerId">
                        <option value="0">Select ecu producer</option>
                        @foreach (var carmaker in Model.AppEcuProducers)
                        {
                            <option value="@carmaker.Id">@carmaker.Name</option>
                        }
                    </select>
                </div>
            </div>
        </div>
    </div>
    <button type="submit" class="btn btn-dark">Apply Filter</button><br /><br />
</form>

<p>
    <a class="btn btn-primary" asp-page="Create">Create New</a>
</p>
<div class="searchable-element">
    <table class="table table-bordered table-sm">
        <thead class="thead-dark">
            <tr>
                @if (Model.AppEcu.Any())
                {
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].EcuType)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].EcuProducer)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Carmaker)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Ecumodel)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].EcuCpu1)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Cpu1type)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Flash)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Flashsizefull)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Flashsizecal)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Flashsizecal2)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Eeprom)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Eepromsize)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Hw1)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Hw2)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Hw3)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Infolink)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Tprot)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Sw1)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Sw2)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Sw3)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Swver)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Tune1Use)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Tune1Cars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Tune1Price)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].AdblueUse)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].AdblueCars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].AdbluePrice)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].DpfUse)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].DpfCars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].DpfPrice)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].EgrUse)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].EgrCar)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].EgrPrice)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].TvaUse)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].TvaCars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].TvaPrice)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].FlapsUse)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].FlapsCars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].FlapsPrice)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].LambdaUse)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].LambdaCars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].LambdaPrice)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].E2Use)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].E2Cars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].E2Price)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].StartstopUse)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].StartstopCars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].StartstopPrice)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].MafUse)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].MafCars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].MafPrice)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].ImmoVirgUse)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].ImmoVirgCars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].ImmoVirgPrice)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].ImmoLearnUse)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].ImmoLearnCars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].ImmoLearnPrice)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].ReadinessUse)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].ReadinessCars)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].ReadinessPrice)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.AppEcu[0].Comments)
                    </th>
                    <th></th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.AppEcu)
            {
                var carmakerId = item.Carmaker;
                var carmakerName = Model.AppCarmakers.FirstOrDefault(c => c.Id == carmakerId)?.Name ?? "Null";
                var ecuTypeId = item.EcuType;
                var ecuTypeName = Model.AppEcuTypes.FirstOrDefault(c => c.Id == ecuTypeId)?.Name ?? "Null";
                var producerId = item.EcuProducer;
                var producerName = Model.AppEcuProducers.FirstOrDefault(c => c.Id == producerId)?.Name ?? "Null";
                <tr class="searchable-row">
                    <td>
                        <p>@ecuTypeName (@Html.DisplayFor(model => item.EcuType))</p>
                    </td>
                    <td>
                        <p>@producerName (@Html.DisplayFor(model => item.EcuProducer))</p>
                    </td>
                    <td>
                        <p>@carmakerName (@Html.DisplayFor(model => item.Carmaker))</p>
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Ecumodel)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EcuCpu1)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Cpu1type)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Flash)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Flashsizefull)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Flashsizecal)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Flashsizecal2)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Eeprom)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Eepromsize)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Hw1)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Hw2)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Hw3)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Infolink)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Tprot)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Sw1)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Sw2)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Sw3)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Swver)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Tune1Use)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Tune1Cars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Tune1Price)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.AdblueUse)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.AdblueCars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.AdbluePrice)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.DpfUse)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.DpfCars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.DpfPrice)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EgrUse)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EgrCar)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EgrPrice)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TvaUse)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TvaCars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TvaPrice)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FlapsUse)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FlapsCars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FlapsPrice)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.LambdaUse)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.LambdaCars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.LambdaPrice)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.E2Use)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.E2Cars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.E2Price)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.StartstopUse)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.StartstopCars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.StartstopPrice)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.MafUse)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.MafCars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.MafPrice)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ImmoVirgUse)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ImmoVirgCars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ImmoVirgPrice)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ImmoLearnUse)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ImmoLearnCars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ImmoLearnPrice)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ReadinessUse)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ReadinessCars)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ReadinessPrice)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Comments)
                    </td>
                    <td>
                        <div class="btn-group" role="group">
                            <a class="btn btn-info" asp-page="./Details" asp-route-id="@item.Id">
                                <i class="bi bi-info-circle"></i> Details
                            </a>
                            <a class="btn btn-warning" asp-page="./Edit" asp-route-id="@item.Id">
                                <i class="bi bi-pencil"></i> Edit
                            </a>
                            <a class="btn btn-danger" asp-page="./Delete" asp-route-id="@item.Id">
                                <i class="bi bi-trash"></i> Delete
                            </a>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function performSearch() {
        var searchTerm = $('#fullTextSearch').val().toLowerCase();

        // Select all rows you want to search within
        var rowsToSearch = $('.searchable-row');

        // Loop through each row and show/hide based on the search term
        rowsToSearch.each(function () {
            var rowText = $(this).text().toLowerCase();
            var rowMatches = rowText.includes(searchTerm);
            $(this).toggle(rowMatches);
        });
    }
</script>
